@model TopicResourceFormViewModel

@inject ITopicResourceStorageService resourceStorage

@using static Daskalo.Web.Constants.ResourceConstants
@using static Daskalo.Web.Extensions.ClaimsPrincipalExtensions

@{
    ViewData["Title"] = "Редактиране на ресурс";
    // Indicates if resource links to an endpoint or to a file 
    bool isBlob = Model.Link.Contains(resourceStorage.ContainerUrl);
}

<nav class="d-flex" style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item">
            <a asp-action="" class="link-success"><i class="fa-solid fa-arrow-left"></i> Назад</a>
        </li>
    </ol>
</nav>

<h3 class="text-center text-secondary">@ViewData["Title"]</h3>

<div class="row justify-content-center">
    <div class="p-3 col-md-6">
        <form asp-action="Edit" method="post" enctype="multipart/form-data">
            <input type="hidden" name="OwnerId" value="@User.Id()" />
            <div class="form-floating">
                <input asp-for="TextToDisplay" class="form-control" aria-required="true" />
                <label asp-for="TextToDisplay" class="form-label"></label>
                <span asp-validation-for="TextToDisplay" class="text-danger"></span>
            </div>

            <div class="btn-group mt-3" role="group" aria-label="Basic radio toggle button group">
                <input type="radio" class="btn-check" name="btnradio" id="file-radio-btn" autocomplete="off" @(isBlob ? "checked" : "")>
                <label asp-for="ResourceFile" class="btn btn-outline-secondary" for="file-radio-btn"></label>

                <input type="radio" class="btn-check" name="btnradio" id="link-radio-btn" autocomplete="off" @(isBlob ? "" : "checked")>
                <label asp-for="Link" class="btn btn-outline-secondary" for="link-radio-btn"></label>
            </div>

            <div id="file-holder-id" class="form-group mt-3" @(isBlob ? "" : "hidden")>
                <span class="mt-1">
                    Ресурсен файл не може да се редактира.
                </span>
            </div>
            <div id="link-holder-id" class="form-group mt-3" @(isBlob ? "hidden" : "")>
                @if (isBlob)
                {
                    <input asp-for="Link" class="form-control mt-1" disabled />
                }
                else
                {
                    <input asp-for="Link" class="form-control mt-1" />
                }
                <span asp-validation-for="Link" class="text-danger"></span>
            </div>

            <div class="form-group mt-3">
                <label asp-for="Icon" class="form-label"></label>
                <div>
                    <div class="btn-group" role="group" aria-label="Basic radio toggle button group">
                        @foreach (var iconRef in ResourceIconRefs)
                        {
                            <input type="radio"
                                   class="btn-check"
                                   asp-for="Icon"
                                   value="@iconRef.Key"
                                   id="@iconRef.Key"
                                   autocomplete="off">
                            <label class="btn btn-outline-secondary"
                                   title="@iconRef.Key"
                                   for="@iconRef.Key"
                                   asp-for="Icon">@Html.Raw(iconRef.Value)</label>
                        }
                    </div>
                </div>
                <span asp-validation-for="Icon" class="text-danger"></span>
            </div>



            <div class="text-center mt-4">
                <a asp-action="" class="btn btn-outline-secondary">Отказ</a>
                <button type="submit" class="btn btn-success">Запази</button>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <partial name="_FontAwesomePartial" />
    <script>
        $('document').ready(() => {
            $('#link-radio-btn').click((e) => {
                $('#file-holder-id').attr('hidden', 'hidden')
                $('#link-holder-id').removeAttr('hidden')
            })

            $('#file-radio-btn').click((e) => {
                $('#file-holder-id').removeAttr('hidden')
                $('#link-holder-id').attr('hidden', 'hidden')
            })
        })
    </script>
}
